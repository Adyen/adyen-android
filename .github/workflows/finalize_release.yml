name: Finalize Release

# Every time we trigger the workflow on a branch.
on:
  workflow_dispatch:

jobs:
  publish_draft_release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # Publish Github release and the tag
      - name: Publish Github release
        uses: ncipollo/release-action@v1
        env:
          VERSION_NAME: ${{ needs.generate_version_name.outputs.version_name }}
        with:
          tag: ${{ env.VERSION_NAME }}
          allowUpdates: true
          updateOnlyUnreleased: true
          omitNameDuringUpdate: true
          omitBodyDuringUpdate: true
          draft: false

  remove_release_branch:
    runs-on: ubuntu-latest
    needs: publish_draft_release

    steps:
      - uses: actions/checkout@v4

      - name: Remove release branch
        run: |
          git push origin --delete ${{ github.ref_name }}
